#!/usr/bin/env node

var program = require('commander');
var normalize = require('path').normalize;
var chalk = require('chalk');
var resolve = require('path').resolve;

function list(val) {
  return val.split(',');
}
program
  .version(require('../package').version, '-v, --version')
  .option('--cwd', 'current work dir')
  .option('--include <includeList>', 'include compile files or dir relative path. "./src" by default.', list)
  .option('--exclude <excludeList>', 'exclude compile files or dir relative path', list)
  .option('--ouput-dir <outputDir>', 'output dir. "./lib" by default')
  .option('--config <path>', 'custom config path, default is webpack.config.js')
  .parse(process.argv);

program.cwd = program.cwd || process.cwd();
program.include = program.include || ['./src/**/*.js', './src/**/*.jsx', './src/**/*.less'];
program.exclude = program.exclude || [];
program.outputDir = program.outputDir || './lib';

require('../lib/transform/transform')(program, function(err) {
  if (err) {
    console.log(chalk.red(err));
    return;
  }
  console.log(chalk.green('output ' + resolve(program.cwd, program.outputDir)));
}).then(() => { }).then((err) => { });
